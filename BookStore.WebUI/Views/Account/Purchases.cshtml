@model IEnumerable<BookStore.Domain.Entities.Purchase>
@using BookStore.Domain.Concrete;
@{
    ViewBag.Title = "Мои заказы";
    var db = new EFDbContext();
}
<link href="~/Content/BackgroundFormStyles.css" rel="stylesheet" />
<table class="table">
    <tr>
        <th>
            Номер заказа
        </th>
        <th>
            Город
        </th>
        <th>
            Получатель
        </th>
        <th></th>
    </tr>
    @foreach (var item in Model.GroupBy(p => p.OrderId).Select(g => g.First()).ToList())
    {
        <tr>
            <td>
                @item.OrderId
            </td>
            <td>
                @db.DeliveryDetails.Find(item.OrderId).City
            </td>
            <td>
                @db.DeliveryDetails.Find(item.OrderId).FullName
            </td>
            <td>               
                    @Ajax.ActionLink("Показать детали", "PurchaseDetails", new {orderId=item.OrderId},
                                                 new AjaxOptions { UpdateTargetId = "showDetails" })               
            </td>
        </tr>
    }
</table>
<div id="showDetails"></div>